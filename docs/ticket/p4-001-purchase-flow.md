### 基本情報

**タイトル**: 購入フローの実装（サンドボックス）

### 概要

ユーザーが選択したプランを購入するためのフローを実装し、サンドボックス環境でテストできるようにします。

### 要件

- [ ] ユーザーが選択した`Package`オブジェクトを使用して購入処理を開始する
- [ ] 購入処理中の待機状態を UI にフィードバックする
- [ ] サンドボックスでの購入成功をハンドリングする
- [ ] 購入失敗・キャンセルのハンドリングを行う

### 技術仕様

**技術スタック**: React Native, RevenueCat
**ファイル**: `src/hooks/paywall/usePaywall.ts` （または購入ロジックを実装するファイル）
**API**: `Purchases.purchasePackage()`

### 実装手順

1.  購入処理を行うカスタムフック（例: `usePaywall`）内に、選択された`Package`を引数に取る非同期関数を定義する。
2.  関数の内部で`Purchases.purchasePackage()`を呼び出す。
3.  `try...catch...finally`ブロックを使用して、各ケースをハンドリングする。
    - **成功時**: 返される`customerInfo`オブジェクトを検証し、`premium`エンタイトルメントが有効になったことを確認する。その後、ペイウォールを閉じるなどの画面遷移を行う。
    - **失敗時**: エラーオブジェクトをキャッチする。`error.userCancelled`プロパティを確認し、ユーザーによるキャンセル操作とそれ以外のエラー（ネットワークエラーなど）を区別する。
    - **共通処理**: `finally`ブロックで、ローディングインジケーターを非表示にするなどの共通処理を行う。
4.  購入処理中はローディングインジケーターを表示し、ユーザーに待機状態であることを明確に伝える。
5.  処理結果（成功、キャンセル、失敗）に応じて、適切なアラートやモーダルでユーザーにフィードバックする。

### テスト項目

- [ ] 購入ボタンをタップすると、OS の購入確認ダイアログが表示されること
- [ ] `docs/sandbox-testing-guide.md` に従って、**サンドックステストユーザー**で購入処理を行う
- [ ] テスト購入が成功し、`premium`エンタイトルメントが有効になることを RevenueCat のデバッグログやダッシュボードで確認できること
- [ ] 購入をキャンセルした場合に、アプリがエラーにならず元の画面に留まること
- [ ] （可能であれば）ネットワーク接続をオフにするなどして、購入失敗時にエラーメッセージが正しく表示されることを確認する

### 完了条件

- [ ] サンドックステストユーザーがプランを購入し、プレミアム機能へのアクセス権（Entitlement）をテスト環境で取得できること

### 注意事項

- テストは必ず `docs/sandbox-testing-guide.md` に記載の手順に沿って、サンドボックス環境で行ってください。
- 実際のクレジットカード情報が要求されることはありません。

### 関連チケット

- P1-002-product-setup
- P2-002-dynamic-plan-display
- P4-002-restore-flow
- P5-002-feature-guard
